<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dashboard</title>
    </head>
    <body>
        <h1>Welcome <%= username %></h1>

        <form id="form">
            <input type="text" placeholder="Enter phone number" id="phone" />
            <input type="submit" value="Update phone number" />
        </form>

        <div id="result"></div>

        <div>
            <h2>Items on sale</h2>
            <ul id="products"></ul>
        </div>

        <a href="/logout"><button>Logout</button></a>
        <a href="/listProduct"><button>List Your Product</button></a>

        <script>
            function getProds() {
                fetch('/api/v1/products', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                })
                    .then((res) => res.json())
                    .then((data) => {
                        if (data.status === 'success') {
                            data.data.products.forEach((product) => {
                                let newItem = document.createElement('li');

                                newItem.appendChild(
                                    document.createTextNode(
                                        `${product.title} -> Rs.${product.price}. Email: ${product.listedBy}`
                                    )
                                );
                                document
                                    .getElementById('products')
                                    .appendChild(newItem);
                            });
                        }
                    });
            }
            getProds();
            function getPhone(event) {
                event.preventDefault();
                const phone = document.getElementById('phone').value;
                const email = '<%= email %>';

                const response = fetch('/api/v1/users', {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone: phone,
                        email: email,
                    }),
                })
                    .then((res) => res.json())
                    .then((data) => {
                        if (data.status === 'success')
                            document.getElementById('result').innerHTML =
                                'Phone number updated successfully';
                    })
                    .catch((err) => console.log(`Some error occurred ${err}`));
            }

            document
                .getElementById('form')
                .addEventListener('submit', getPhone);
        </script>
    </body>
</html>
